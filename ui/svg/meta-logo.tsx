"use client";
import {useEffect} from "react";
import {animate, motion, useMotionValue, useTransform} from "framer-motion";
import {interpolate} from "flubber";
import {create} from 'zustand';
import {getIndex} from "@/lib/use-flubber";

type Store = {
  pathIndex: number
  inc: () => void
}

const useStore = create<Store>()((set) => ({
  pathIndex: 0,
  inc: () => set((state) => {
    if (state.pathIndex === 6 - 1) return {pathIndex: 1} // paths.length === 6
    return {pathIndex: state.pathIndex + 1}
  }),
}))

export const facebookCircle = "M 48,24 C 48.679491,40.446854 29.75048,53.094815 14.815598,46.173109 -0.63934396,40.506938 -5.0807171,18.178647 7.0294373,7.0294373 17.296887,-4.1103228 37.167342,-1.4316103 44.506066,11.529985 46.783262,15.262953 48.006091,19.627286 48,24 Z";

export const facebookInside = "m 33.605635,9.6820001 c 0,1.2557239 0,2.5114479 0,3.7671719 -1.761215,0.05776 -3.541261,-0.150209 -5.284648,0.188513 -1.30778,0.214236 -2.037949,1.721775 -2.072365,3.160086 -0.08665,1.203519 -0.03655,2.412954 -0.04998,3.61944 2.125301,0 4.250601,0 6.375902,0 0,1.173651 0,2.347301 0,3.520952 -2.125301,0 -4.250601,0 -6.375902,0 0,8.018579 0,16.037159 0,24.055737 -1.297626,0 -2.595252,0 -3.892878,0 0,-8.018578 0,-16.037158 0,-24.055737 -1.234498,0 -2.468997,0 -3.703495,0 0,-1.173651 0,-2.347301 0,-3.520952 1.234498,0 2.468997,0 3.703495,0 -0.02115,-2.917522 -0.09392,-6.205059 1.718073,-8.484458 1.864411,-2.2403057 4.714234,-2.2963549 7.213635,-2.2507529 0.789386,0 1.578773,0 2.368159,0 z";

export const messengerCircle = "M 24.115234 0.00390625 C 17.791871 -0.11609977 11.453327 2.1094871 6.9550781 6.9765625 C -2.5366733 15.691255 -1.8735477 31.245106 6.2832031 40.306641 C 6.0763166 41.139979 4.8217192 46.274146 5.2304688 46.873047 C 5.6740348 47.52296 6.3179285 47.921049 8.1328125 47.820312 C 9.3729492 47.751478 11.303885 45.830977 12.771484 45.210938 C 13.412479 45.523978 14.067312 45.818039 14.751953 46.068359 C 29.70758 52.980735 48.662856 40.350466 47.982422 23.925781 C 47.98852 19.558962 46.764734 15.200593 44.484375 11.472656 C 40.350608 4.1915868 32.245273 0.1581997 24.115234 0.00390625 z";

export const messengerInside = "m 10.6248,30.622337 7.704084,-13.162389 c 0,0 1.582866,-1.797663 3.458844,-0.738628 1.875978,1.059035 7.178304,5.154795 7.178304,5.154795 0,0 0.04647,0.643741 1.028164,0.166378 0.981696,-0.477362 8.142777,-6.172236 8.142777,-6.172236 0,0 2.741663,-0.344454 1.402515,2.117421 -1.339149,2.461875 -8.27211,12.103029 -8.27211,12.103029 0,0 -2.2695,1.358646 -3.724334,-0.0019 -1.454833,-1.360596 -6.422453,-4.903604 -6.422453,-4.903604 0,0 -0.974871,-0.220321 -1.514625,0.519282 -0.539754,0.739602 -7.772976,5.743293 -7.772976,5.743293 0,0 -1.788889,0.564125 -1.20819,-0.825392 z";

export const instagramCircle = "m 10.87355,1.997355 h 26.252896 c 4.917412,0 8.876195,3.9587832 8.876195,8.876195 v 26.2529 c 0,4.917412 -3.958783,8.876196 -8.876195,8.876196 H 10.87355 c -4.9174118,0 -8.876195,-3.958784 -8.876195,-8.876196 v -26.2529 c 0,-4.9174118 3.9587832,-8.876195 8.876195,-8.876195 z";
export const instagramInside1 = "m 31.734871,23.868916 a 8,8 0 0 1 -8,8 8,8 0 0 1 -8,-8 8,8 0 0 1 8,-8 8,8 0 0 1 8,8 z";
export const instagramInside2 = "m 35.567669,11.441866 a 3.0007325,3.0007328 0 0 0 -2.999999,3.000001 3.0007325,3.0007328 0 0 0 2.999999,2.999999 3.0007325,3.0007328 0 0 0 3.000001,-2.999999 3.0007325,3.0007328 0 0 0 -3.000001,-3.000001 z";
export const whatsappCircle = messengerCircle;
export const whatsappInside = "m 17.066155,10.901063 c -0.127123,0.0027 -0.254113,0.01347 -0.381127,0.02158 -0.198485,0.01202 -0.398041,0.01768 -0.596858,0.02158 -0.02187,0.0093 -0.04552,0.01417 -0.06712,0.02397 -0.112687,0.0512 -0.208678,0.05994 -0.282849,0.04315 -0.05001,0.02385 -0.09843,0.0511 -0.148612,0.07431 -0.178521,0.08343 -0.359578,0.159032 -0.53933,0.239701 -0.03116,0.0149 -0.06239,0.03011 -0.09348,0.04555 l -1.77859,1.498137 c 0,0 -2.033736,3.261498 -2.186083,4.604677 -0.132699,1.169976 1.032056,3.783247 1.349523,4.470443 0.05451,0.03613 0.108159,0.09262 0.155806,0.172586 0.06169,0.103566 0.121758,0.208342 0.179777,0.31401 0.01482,0.02699 0.02842,0.05364 0.03835,0.0791 v 0.0024 c 0.686507,0.814298 9.024524,10.659475 13.538373,13.586312 4.2541,2.758433 6.572105,1.169096 7.447542,1.061881 0.111188,-0.06257 0.220639,-0.127372 0.328392,-0.196557 0.153442,-0.09139 0.307358,-0.180286 0.462626,-0.268466 0.07603,-0.03768 0.152816,-0.07127 0.23251,-0.09828 0.09511,-0.06853 0.189012,-0.138758 0.29004,-0.198953 0.07853,-0.04233 0.157248,-0.08291 0.237305,-0.122249 0.04794,-0.02355 0.09374,-0.04082 0.13663,-0.05034 1.219887,-1.117525 2.60675,-2.681171 2.893204,-3.005864 0.03433,-0.09481 0.06803,-0.189576 0.100674,-0.285246 0.03073,-0.110189 0.06847,-0.218188 0.107868,-0.325995 -0.01327,-0.700352 -0.180353,-2.281658 -1.363905,-3.439724 -1.555741,-1.522245 -4.409271,-3.4642 -5.522735,-3.305491 -1.113464,0.158725 -1.096808,1.652847 -2.11657,2.62234 -1.019743,0.969491 -2.190876,0.582476 -2.190876,0.582476 0,0 -5.908299,-5.862797 -7.303722,-6.82192 -0.705223,-0.48473 -0.76225,-0.886706 -0.625622,-1.258436 -0.0018,-0.02915 -0.0014,-0.06025 0.0024,-0.09348 0.01227,-0.109517 0.03488,-0.214583 0.07191,-0.318803 0.04251,-0.146294 0.06396,-0.299322 0.122248,-0.441052 0.05996,-0.156904 0.140101,-0.300493 0.249291,-0.429067 0.01686,-0.01986 0.03327,-0.02928 0.05034,-0.04554 l 0.0024,-0.0024 c 0.03044,-0.0463 0.06585,-0.08863 0.107867,-0.127043 0.139194,-0.12193 0.296775,-0.216005 0.479404,-0.25648 0.0082,-0.0018 0.01589,-0.0032 0.02397,-0.0048 0.626813,-0.460732 1.570711,-0.908361 1.872073,-1.419036 0.08349,-0.141456 0.134928,-0.30135 0.174983,-0.465022 v -0.575294 c 0,-0.04182 0.0032,-0.08018 0.0096,-0.115057 -0.002,-0.120677 -0.0041,-0.241116 -0.0096,-0.361949 -0.0079,-0.160544 -0.01582,-0.323531 -0.04554,-0.481802 -0.02427,-0.106612 -0.0566,-0.210456 -0.09109,-0.314009 -0.363079,-0.735165 -1.52365,-2.95414 -2.981892,-4.345799 -0.0894,-0.02279 -0.179082,-0.04474 -0.268466,-0.06712 -0.289507,-0.07598 -0.580231,-0.136627 -0.87731,-0.172585 -0.209366,-0.02299 -0.420023,-0.0353 -0.630417,-0.04315 -0.145163,-0.0052 -0.291018,-0.0062 -0.436258,-0.0073 -0.04248,-0.0015 -0.08468,-8.95e-4 -0.127041,0 z";
export const metaInside1 = "m 15.346337,15.264476 c -3.233156,0 -6.0521391,1.534195 -8.0054491,3.72815 -2.2016629,2.473869 -3.3597456,5.677337 -3.3597456,8.750895 0,0.211262 0.00726,0.418999 0.021608,0.623518 0.014346,0.204518 0.036086,0.405566 0.064867,0.602765 0.02878,0.1972 0.064867,0.390968 0.1080818,0.580281 0.043259,0.18931 0.093559,0.374346 0.1513411,0.555198 0.057782,0.180852 0.123092,0.357436 0.1954417,0.529256 0.072394,0.171824 0.151651,0.339366 0.238701,0.501586 0.08705,0.162216 0.1818927,0.319269 0.2836428,0.471314 0.1017944,0.152045 0.2112045,0.298883 0.3277876,0.440182 1.1427184,1.387308 2.9870616,2.308147 5.9048277,2.308147 2.459404,0 4.327656,-0.805407 6.515416,-2.928207 1.248232,-1.212137 1.881359,-1.946385 4.377602,-5.172359 l 1.242695,-1.604203 c 0.106886,-0.138067 0.200533,-0.254123 0.305294,-0.389156 0.100378,0.119881 0.199471,0.234485 0.300911,0.358024 l 3.53792,4.305832 c 1.189298,1.44931 2.735785,3.06189 4.057606,3.969423 1.720144,1.182515 3.275575,1.460646 5.031406,1.460646 0.706096,0 1.340595,-0.06794 1.908634,-0.186795 0.283997,-0.05943 0.55108,-0.13169 0.802533,-0.214472 0.260219,-0.08567 0.50233,-0.182778 0.729032,-0.288841 0.211691,-0.09901 0.409524,-0.205417 0.593232,-0.318246 0.380168,-0.233525 0.701713,-0.492602 0.96946,-0.760159 0.133851,-0.13378 0.253799,-0.269664 0.361483,-0.405588 0.334208,-0.421488 0.617895,-0.885066 0.840567,-1.40184 8.9e-5,-2.44e-4 -8.8e-5,-4.43e-4 0,-8.86e-4 0.07412,-0.172111 0.141822,-0.350094 0.202349,-0.534444 8.9e-5,-2.62e-4 -8.8e-5,-4.43e-4 0,-8.86e-4 0.06053,-0.184372 0.113661,-0.375041 0.16002,-0.572497 4.4e-5,-2.66e-4 -8.9e-5,-4.43e-4 0,-8.86e-4 0.04631,-0.197483 0.08608,-0.40174 0.117601,-0.613144 4.4e-5,-2.74e-4 -4.4e-5,-4.42e-4 0,-8.85e-4 0.03148,-0.211431 0.05486,-0.430189 0.07089,-0.656381 4.4e-5,-2.79e-4 0,-4.43e-4 0,-8.86e-4 0.01607,-0.226507 0.02422,-0.460076 0.02422,-0.702217 0,-3.258359 -1.11872,-6.415393 -3.424569,-8.922126 -2.106953,-2.288948 -4.860051,-3.510219 -7.750365,-3.510219 -1.721472,0 -3.431387,0.560299 -5.017547,1.567881 -1.072627,0.681646 -2.067147,1.543574 -2.991311,2.453436 -1.136033,-1.047889 -2.194755,-1.852353 -3.218809,-2.46122 -1.943392,-1.15651 -3.805047,-1.560097 -5.677373,-1.560097 z m 16.699237,2.459488 c 1.883396,0 3.595569,0.907591 4.916372,2.392899 1.861434,2.094024 2.705942,5.024835 2.705942,7.665573 0,0.231639 -0.009,0.459833 -0.03024,0.68146 -0.02121,0.221628 -0.05402,0.436343 -0.101175,0.642545 -0.188623,0.825176 -0.603947,1.504586 -1.397536,1.866237 -0.19832,0.09038 -0.420505,0.161384 -0.66846,0.209279 -0.247955,0.0479 -0.521857,0.07264 -0.824185,0.07264 -0.953343,0 -1.687467,-0.275726 -2.735342,-1.201205 -0.814887,-0.720677 -2.207154,-2.248438 -4.654337,-5.219059 l -1.013561,-1.231468 c -0.721947,-0.87622 -1.406746,-1.662105 -2.062542,-2.371278 0.115387,-0.130234 0.23228,-0.267756 0.346782,-0.391756 1.842306,-1.995781 3.4812,-3.115869 5.518283,-3.115869 z m -16.768443,0.662434 c 2.079546,0 3.382815,0.947463 4.396641,1.732192 0.503791,0.390334 1.212101,1.048163 2.026235,1.89218 l -1.673386,1.874017 c -1.244159,1.392365 -3.093372,3.613484 -4.663015,5.195711 -1.958756,1.974112 -2.975195,2.174969 -4.086166,2.174969 -0.861511,0 -1.7061081,-0.283572 -2.2726851,-0.95128 h 8.86e-4 c -0.05402,-0.06372 -0.106975,-0.132722 -0.157363,-0.206688 -0.151208,-0.221897 -0.284086,-0.488688 -0.386589,-0.797344 -0.136641,-0.411538 -0.218776,-0.89718 -0.218776,-1.44594 0,-2.660726 1.034416,-5.431016 2.7258231,-7.291117 1.196073,-1.316398 2.625445,-2.1767 4.30844,-2.1767 z";
const metaCircle = facebookCircle;

export default function SVGMorph({paths, colors}: { paths: string[], colors: string[] }) {
  const pathIndex = useStore((state) => state.pathIndex);
  const progress = useMotionValue(pathIndex);
  const arrayOfIndex = paths.map((_, i) => i)
  const path = useTransform(progress, arrayOfIndex, paths, {
    mixer: (a, b) => interpolate(a, b, {maxSegmentLength: 3})
  })
  const fill = useTransform(progress, paths.map(getIndex), colors);
  
  
  useEffect(() => {
    
    const animation = animate(progress, pathIndex, {
      duration: 0.6,
      ease: "easeInOut",
      // delay: 0.2,
      onComplete: () => {
        if (pathIndex === paths.length - 1) {
          progress.set(0);
        }
      }
    })
    
    return () => {
      animation.stop()
    }
    
  }, [pathIndex])
  
  
  return (
    <motion.path fill={fill} d={path}/>
  )
}

export function MetaLogo() {
  const inc = useStore(state => state.inc);
  const pathIndex = useStore(state => state.pathIndex);
  return (
    <button className="bg-white p-6 gap-4 rounded-full flex flex-col justify-center items-center" onClick={inc}>
      <p>Click to Animate!</p>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="64" height="64">
        <SVGMorph colors={["#000", "#000", "#000", "#000", "#000", "#000"]}
                  paths={[facebookCircle, messengerCircle, instagramCircle, whatsappCircle, metaCircle, facebookCircle]}/>
        <SVGMorph colors={["#FFF", "#FFF", "#FFF", "#FFF", "#FFF", "#FFF"]}
                  paths={[facebookInside, messengerInside, instagramInside1, whatsappInside, metaInside1, facebookInside]}/>
        {/* path that appears only on instagram turn and represents second circle*/}
        <motion.path initial={{opacity: 0, scale: 0}}
                     transition={{duration:0.4, ease:"easeInOut"}}
                     animate={pathIndex === 2 ? {opacity: 1, scale: 1} : {opacity:0, scale:0}}
                     fill={"#FFF"}
                     d={instagramInside2}
                     />
                     {/*// d={"m 35.567669,11.441866 a 3.0007325,3.0007328 0 0 0 -2.999999,3.000001 3.0007325,3.0007328 0 0 0 2.999999,2.999999 3.0007325,3.0007328 0 0 0 3.000001,-2.999999 3.0007325,3.0007328 0 0 0 -3.000001,-3.000001 z"}/>*/}
      </svg>
    
    </button>
  )
}