"use client";
import {useEffect} from "react";
import {animate, motion, useMotionValue, useTransform} from "framer-motion";
import {interpolate} from "flubber";
import {create} from 'zustand';
import {getIndex} from "@/lib/use-flubber";

// store
type Store = {
  pathIndex: number
  inc: () => void
}

const useStore = create<Store>()((set) => ({
  pathIndex: 0,
  inc: () => set((state) => {
    if (state.pathIndex === 6 - 1) return {pathIndex: 1} // paths.length === 6
    return {pathIndex: state.pathIndex + 1}
  }),
}))

// data
export const facebookCircle = "M 48,24 C 48.679491,40.446854 29.75048,53.094815 14.815598,46.173109 -0.63934396,40.506938 -5.0807171,18.178647 7.0294373,7.0294373 17.296887,-4.1103228 37.167342,-1.4316103 44.506066,11.529985 46.783262,15.262953 48.006091,19.627286 48,24 Z";
export const facebookInside1 = "m 33.610644,13.540802 -4.649324,-0.08189 c 0,0 -2.290624,-0.241118 -2.746538,3.421799 -0.455915,3.662917 0.03038,31.580637 0.03038,31.580637 l -4.115745,0.0073 0.188638,-30.35961 c 0,0 -0.389624,-8.3119166 6.691843,-8.4519731 7.081466,-0.1400565 4.571659,0.1463932 4.571659,0.1463932 z";
export const facebookInside2 = "m 18.60071,20.392363 h 13.940664 v 3.524321 H 18.60071 Z";

export const messengerCircle = "M 24.115234 0.00390625 C 17.791871 -0.11609977 11.453327 2.1094871 6.9550781 6.9765625 C -2.5366733 15.691255 -1.8735477 31.245106 6.2832031 40.306641 C 6.0763166 41.139979 4.8217192 46.274146 5.2304688 46.873047 C 5.6740348 47.52296 6.3179285 47.921049 8.1328125 47.820312 C 9.3729492 47.751478 11.303885 45.830977 12.771484 45.210938 C 13.412479 45.523978 14.067312 45.818039 14.751953 46.068359 C 29.70758 52.980735 48.662856 40.350466 47.982422 23.925781 C 47.98852 19.558962 46.764734 15.200593 44.484375 11.472656 C 40.350608 4.1915868 32.245273 0.1581997 24.115234 0.00390625 z";
export const messengerInside1 = "m 18.070953,17.538973 c 0,0 1.628677,-1.901884 4.128677,-0.68704 2.5,1.214844 6.870404,4.867647 6.870404,4.867647 l -4.835937,5.546645 -2.650966,-2.153722 c 0,0 -0.637178,-0.568475 -1.953814,0.462775 -1.316636,1.03125 -7.525046,5.780102 -7.525046,5.780102 0,0 -2.5512409,0.50965 -1.831572,-1.859835 0.71967,-2.369485 7.798254,-11.956572 7.798254,-11.956572 z";
export const messengerInside2 = "m 28.571642,21.358596 c 0,0 0.315717,0.701517 1.955653,-0.371553 1.639935,-1.07307 7.413143,-5.855239 7.413143,-5.855239 0,0 2.184284,-0.622472 1.853401,1.559053 -0.330882,2.181526 -8.363971,12.670956 -8.363971,12.670956 0,0 -2.272978,1.636719 -4.734834,-0.310891 -2.461857,-1.947611 -2.658778,-1.935432 -2.658778,-1.935432 z";

export const instagramCircle = "m 10.87355,1.997355 h 26.252896 c 4.917412,0 8.876195,3.9587832 8.876195,8.876195 v 26.2529 c 0,4.917412 -3.958783,8.876196 -8.876195,8.876196 H 10.87355 c -4.9174118,0 -8.876195,-3.958784 -8.876195,-8.876196 v -26.2529 c 0,-4.9174118 3.9587832,-8.876195 8.876195,-8.876195 z";
export const instagramInside1 = "m 31.734871,23.868916 a 8,8 0 0 1 -8,8 8,8 0 0 1 -8,-8 8,8 0 0 1 8,-8 8,8 0 0 1 8,8 z";
export const instagramInside2 = "m 35.567669,11.441866 a 3.0007325,3.0007328 0 0 0 -2.999999,3.000001 3.0007325,3.0007328 0 0 0 2.999999,2.999999 3.0007325,3.0007328 0 0 0 3.000001,-2.999999 3.0007325,3.0007328 0 0 0 -3.000001,-3.000001 z";

export const whatsappCircle = messengerCircle;
export const whatsappInside1 = "m 15.543659,10.961857 c -0.555785,0.0183 -1.236933,0.149686 -2.070313,0.246094 -1.904867,0.220358 -3.234375,5.261718 -3.234375,5.261718 0,0 -0.08226,2.329397 1.746094,7.111328 1.212666,3.171646 5.289382,6.744009 7.902344,8.794922 0.06556,0.01401 0.138482,0.05386 0.208984,0.128906 0.06856,0.07298 0.143195,0.14007 0.220703,0.203125 0.01532,0.01178 0.02974,0.02351 0.04492,0.03516 0.02088,0.01636 0.04125,0.03291 0.0625,0.04883 0.09699,0.07266 0.197205,0.140884 0.296875,0.208985 0.266138,0.170402 0.52367,0.353499 0.779297,0.539062 0.199347,0.142266 0.408822,0.265181 0.621093,0.386719 0.06308,0.03611 0.108488,0.07723 0.138672,0.11914 0.164851,-0.157978 3.945669,-3.797412 2.564454,-4.162109 -1.411533,-0.372702 -5.683137,-4.712664 -6.984376,-6.580078 -1.301236,-1.867413 0.313192,-2.676244 1.617188,-4.082031 1.303997,-1.405788 0.449447,-0.720252 -1.027344,-4.314452 0,0 -0.671762,-1.974153 -1.30664,-3.146485 -0.317441,-0.586166 -0.754684,-0.779555 -1.34961,-0.798828 -0.07437,-0.0024 -0.151071,-0.0026 -0.230468,0 z";
export const whatsappInside2 = "m 21.196002,27.356387 c 0,0 -3.33548,2.277337 -3.33789,3.421875 0.153761,0.125035 0.306783,0.250128 0.460937,0.375 0.423294,0.325347 0.846414,0.651294 1.263672,0.984375 0.196681,0.160089 0.106374,0.08609 0.285156,0.234375 0.07035,0.0095 0.150826,0.05012 0.228516,0.132813 0.182824,0.194605 0.405576,0.34617 0.625,0.496094 0.266138,0.170402 0.52367,0.353499 0.779297,0.539062 0.199347,0.142266 0.408822,0.265181 0.621093,0.386719 0.02233,0.01279 0.04252,0.02523 0.06055,0.03906 2.001832,1.091373 4.292464,2.179759 5.9375,2.84375 3.55398,1.434507 6.007595,0.553878 8.277344,-0.708984 2.269749,-1.262861 2.107422,-5.47461 2.107422,-5.474609 l -3.621094,-1.767579 c 0,0 -0.144888,0.01379 -2.498047,-1.171875 -2.353153,-1.18565 -3.978515,3.638672 -3.978515,3.638672 z";

export const metaCircle = facebookCircle;
export const metaInside1 = "m 13.896551,25.328411 c 0,0.991642 0.217567,1.752907 0.502133,2.21347 0.373016,0.603299 0.929305,0.859385 1.496476,0.859385 0.73145,0 1.40066,-0.181564 2.690266,-1.965249 1.033393,-1.429573 2.25056,-3.436264 3.069653,-4.694314 l 1.387196,-2.131332 c 0.963567,-1.480154 2.078884,-3.125583 3.357701,-4.240899 1.044307,-0.910404 2.170193,-1.416111 3.303573,-1.416111 1.902884,0 3.715389,1.102693 5.102555,3.170852 1.518148,2.264892 2.255006,5.117881 2.255006,8.061932 0,1.750263 -0.344941,3.036262 -0.93201,4.052277 -0.567077,0.982501 -1.672508,1.964256 -3.53199,1.964256 v -2.801846 c 1.592202,0 1.989468,-1.463119 1.989468,-3.137461 0,-2.385988 -0.55629,-5.033815 -1.78182,-6.925817 -0.869582,-1.342023 -1.99665,-2.162017 -3.236637,-2.162017 -1.341153,0 -2.420373,1.011663 -3.633279,2.814904 -0.644834,0.958249 -1.306768,2.12589 -2.050063,3.443538 l -0.818253,1.449501 c -1.64347,2.914795 -2.059857,3.578345 -2.881716,4.673546 -1.440361,1.918025 -2.670429,2.645216 -4.28965,2.645216 -1.920945,0 -3.135595,-0.831839 -3.887905,-2.085318 -0.614086,-1.021332 -0.91572,-2.361614 -0.91572,-3.888685 z";
export const metaInside2 = "m 18.573518,13.953174 c -2.128595,0 -3.984502,1.386234 -5.270501,3.368551 -1.449501,2.235202 -2.211482,5.129851 -2.211482,7.906919 0,1.527069 0.301882,2.866856 0.915969,3.888186 l 2.391304,-1.574855 c -0.284566,-0.460564 -0.502132,-1.222233 -0.502132,-2.213875 0,-2.40402 0.681707,-4.906844 1.795281,-6.587497 0.09846,-0.148673 0.199162,-0.291436 0.302411,-0.426521 0.103243,-0.135117 0.209391,-0.26271 0.317521,-0.382779 0.108132,-0.120096 0.218779,-0.232178 0.331853,-0.335831 0.113037,-0.103629 0.228105,-0.199131 0.346152,-0.284876 0.118055,-0.08578 0.238988,-0.161948 0.362074,-0.228387 0.369254,-0.199409 0.760674,-0.308784 1.17619,-0.308784 1.369072,0 2.227585,0.856276 2.895052,1.565312 0.620057,0.659321 1.692282,2.114759 2.860824,4.067262 l 2.32928,3.890581 c 0.782996,1.309502 1.801189,2.76659 2.671425,3.586583 1.132508,1.068434 2.156047,1.319421 3.312061,1.319421 1.859481,0 2.965407,-0.982283 3.532487,-1.964783 0.587068,-1.016016 0.931855,-2.301859 0.931855,-4.052155 l -2.474874,0.07801 c 0,1.674343 -0.397266,3.136963 -1.989468,3.136963 -0.627673,0 -1.110188,-0.249215 -1.800071,-1.085438 -0.536517,-0.651145 -1.453418,-2.031783 -3.064555,-4.715829 L 27.064521,21.486864 C 25.203173,18.386649 23.711887,16.50469 22.3121,15.362512 21.03263,14.317552 19.806197,13.95318 18.573518,13.95318 Z";

export const paths0 = [facebookCircle, messengerCircle, whatsappCircle, instagramCircle, metaCircle, facebookCircle];
export const paths1 = [facebookInside1, messengerInside2, whatsappInside1, instagramInside1, metaInside1, facebookInside1];
export const paths2 = [facebookInside2, messengerInside1, whatsappInside2, instagramInside2, metaInside2, facebookInside2];

export const colorsWhite = ["#FFF", "#FFF", "#FFF", "#FFF", "#FFF", "#FFF"];
export const colorsBlack = ["#000", "#000", "#000", "#000", "#000", "#000"];

// components
export function SVGMorph({paths, colors, metaInst}: { paths: string[], colors: string[], metaInst?: boolean }) {
  const pathIndex = useStore((state) => state.pathIndex);
  const progress = useMotionValue(pathIndex);
  const arrayOfIndex = paths.map((_, i) => i)
  const path = useTransform(progress, arrayOfIndex, paths, {
    mixer: (a, b) => interpolate(a, b, {maxSegmentLength: 3})
  })
  const fill = useTransform(progress, paths.map(getIndex), colors);
  
  
  useEffect(() => {
    
    const animation = animate(progress, pathIndex, {
      duration: 0.6,
      ease: "easeInOut",
      // delay: 0.2,
      onComplete: () => {
        if (pathIndex === paths.length - 1) {
          progress.set(0);
        }
      }
    })
    
    return () => {
      animation.stop()
    }
    
  }, [pathIndex])
  
  
  return (
    <motion.path fill={fill} d={path}/>
  )
}

export function MetaLogo() {
  const inc = useStore(state => state.inc);
  return (
    <button className="bg-white p-6 gap-4 rounded-full flex flex-col justify-center items-center" onClick={inc}>
      <p>Click to Animate!</p>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="64" height="64">
        <SVGMorph colors={colorsBlack}
                  paths={paths0}/>
        <SVGMorph colors={colorsWhite}
                  paths={paths1}/>
        <SVGMorph colors={colorsWhite}
                  paths={paths2}/>
      </svg>
    
    </button>
  )
}
